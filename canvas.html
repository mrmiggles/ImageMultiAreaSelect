<!DOCTYPE html>
<html>
	<head>
		<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
		<meta content="utf-8" http-equiv="encoding">		
		<link rel="stylesheet" type="text/css" href="main.css">
 		<script src="jquery.min.js"></script> 

		 <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
		 <link rel="stylesheet" href="resize_edit.css">

		<!-- Optional theme -->
		<link rel="stylesheet" href="bootstrap/css/bootstrap-theme.min.css">

		<!-- Latest compiled and minified JavaScript -->
		<script src="bootstrap/js/bootstrap.min.js"></script>					  
	</head>
	

	<body>
		<div class="row">
			<div class="col-xs-6">
				<img id="freckles" class="img-responsive" src="freckles1.jpg"/>	
			</div>
		</div>


	<!--<p>Canvas:</p>
	<canvas id="myCanvas" width="400" height="400" style="border:1px solid #d3d3d3;">
	Your browser does not support the HTML5 canvas tag.
	</canvas>
	-->
	</body>

<script type="text/javascript">

$(function(){

	//void ctx.drawImage(image, dx, dy);
	//void ctx.drawImage(image, dx, dy, dWidth, dHeight);
	//void ctx.drawImage(image, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight);
		//var c = document.getElementById("myCanvas");
	    //var ctx = c.getContext("2d");
	    //ctx.drawImage(img, 550, 550, this.width, this.height, 0, 0, this.width, this.height);
	    //ctx.drawImage(img, 0,0)

		var rectangles = new Object();

		var img = document.getElementById("freckles");
		var p = img.parentElement;
		var canvas = document.createElement("div");
		canvas.classList.add("canvas")
		p.appendChild(canvas);
		canvas.appendChild(img);

		initDraw(canvas);	    
});



function initDraw(canvas) {
	var OFFSET = 5;
	var boxPositions = ["top left", "top", "top right", "right", "bottom right", "bottom", "bottom left", "left"];

    function setMousePosition(e) {
        var ev = e || window.event; //Moz || IE
        if (ev.pageX) { //Moz
            mouse.x = ev.pageX + window.pageXOffset;
            mouse.y = ev.pageY + window.pageYOffset;
        } else if (ev.clientX) { //IE
            mouse.x = ev.clientX + document.body.scrollLeft;
            mouse.y = ev.clientY + document.body.scrollTop;
        }
    };

    var mouse = {
        x: 0,
        y: 0,
        startX: 0,
        startY: 0
    };
    var shapes = new Object();
    var element = null;

    canvas.onmousemove = function (e) {
        setMousePosition(e);
        if (element !== null) {

        	if((Math.abs(mouse.x - mouse.startX)) < canvas.offsetWidth) { //don't go out of picture bounds
 	            element.style.width = Math.abs(mouse.x - mouse.startX) + 'px';
	            element.style.height = Math.abs(mouse.y - mouse.startY) + 'px';
	            element.style.left = (mouse.x - mouse.startX < 0) ? mouse.x + 'px' : mouse.startX + 'px';
	            element.style.top = (mouse.y - mouse.startY < 0) ? mouse.y + 'px' : mouse.startY + 'px';  
        	}
        }
    }

    canvas.onclick = function (e) {
        if (element !== null) {
            element = null;
            canvas.style.cursor = "default";
            shapes.x1 = mouse.startX;
            shapes.y1 = mouse.startY;
            shapes.x2 = mouse.x;
            shapes.y2 = mouse.y;
            console.log(shapes);

			var ORIGINAL_TOP = $(element).position().top, ORIGINAL_LEFT = $(element).position().left, ORIGINAL_WIDTH = $(element).width(), ORIGINAL_HEIGHT = $(element).height();
            var p = element.parentElement;

            for(var i=0; i < boxPositions.length; i++){
            		var e = document.createElement('div');
            		e.className = boxPositions[i] + " control-element"
            		p.appendChild(e);
            }
           
            for(var i=0; i < p.children.length; i++) {
            	var childClasses =  p.children[i].classList;

            	if(childClasses.indexOf("top")){
					$(p.children[i]).css({top: (ORIGINAL_TOP - OFFSET) + 'px'});
            	} 
            	else if(childClasses.indexOf("left")){
            		$(p.children[i]).css({left: (ORIGINAL_LEFT - OFFSET) + 'px'})
            	}
            	else if(childClasses.indexOf("bottom")){
            		$(p.children[i]).css({top: (ORIGINAL_TOP + ORIGINAL_HEIGHT - OFFSET) + 'px'});
            	}
            	else if(childClasses.indexOf("right")){
            		$(p.children[i]).css({left: (ORIGINAL_LEFT + ORIGINAL_WIDTH - OFFSET) + 'px'});
            	}
            }
		    

		    /*$('.top').css({top: (ORIGINAL_TOP - OFFSET) + 'px'});
		    $('.left').css({left: (ORIGINAL_LEFT - OFFSET) + 'px'});
		    $('.bottom').css({top: (ORIGINAL_TOP + ORIGINAL_HEIGHT - OFFSET) + 'px'});
		    $('.right').css({left: (ORIGINAL_LEFT + ORIGINAL_WIDTH - OFFSET) + 'px'});

		    $('.control-element').css({height: (2 * OFFSET) + 'px', width: (2 * OFFSET) + 'px'});  
		              
		    */
	        //console.log("finished");
        } else {
        	console.log(e.target.classList)
            //console.log("Begin");
            mouse.startX = mouse.x;
            mouse.startY = mouse.y;

            element = document.createElement('div');
            element.className = 'rectangle'
            element.style.left = mouse.x + 'px';
            element.style.top = mouse.y + 'px';
            canvas.appendChild(element)
            canvas.style.cursor = "crosshair";
        }
    }
}

function resizeBox(box,top, left, width, height) {
    box.css({
        top: top + 'px',
        left: left + 'px',
        width: width + 'px',
        height: height + 'px'
    });
}

	
</script>
</html>